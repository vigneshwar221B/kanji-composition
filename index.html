<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanji Composition Finder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #jpInput {
            width: 300px;
            padding: 10px;
            font-size: 16px;
        }
        button {
            padding: 10px;
            font-size: 16px;
        }
        #output {
            margin-top: 20px;
        }
        .kanji {
            font-weight: bold;
        }
        #loading {
            display: none;
            font-style: italic;
            color: gray;
        }
    </style>
</head>
<body>

    <h1>Kanji Composition Finder</h1>
    <input type="text" id="jpInput" placeholder="Enter Japanese text" />
    <button type="button" onclick="processInput()">Submit</button>
    <div id="loading">Loading...</div>
    <div id="output"></div>

    <script>
        async function processInput() {
            const jpText = document.querySelector('#jpInput').value;
            const outputDiv = document.querySelector('#output');
            outputDiv.innerHTML = ''; // Clear previous output
            document.querySelector('#loading').style.display = 'block';

            if (!jpText.trim()) {
                outputDiv.innerHTML = 'Please enter some text.';
                document.querySelector('#loading').style.display = 'none';
                return;
            }

            const kanjiArray = extractKanji(jpText);

            if (kanjiArray.length === 0) {
                outputDiv.innerHTML = 'No kanji found.';
                document.querySelector('#loading').style.display = 'none';
                return;
            }

            await displayKanji(kanjiArray);
        }

        function extractKanji(text) {
            return text.match(/[\u4E00-\u9FAF]+/g) || [];
        }

        async function getKanjiData(kanji) {
            try {
                const response = await fetch(`https://kanjiapi.dev/v1/kanji/${kanji}`);
                return response.json();
            } catch (error) {
                return null;
            }
        }

        async function displayKanji(kanjiArray) {
            const outputDiv = document.querySelector('#output');
            document.querySelector('#loading').style.display = 'none'; // Hide loading

            for (const kanji of kanjiArray) {
                const kanjiData = await getKanjiData(kanji);

                if (kanjiData) {
                    const meanings = kanjiData.meanings.join(', ');
                    const kunReadings = kanjiData.kun_readings.join(', ');
                    const onReadings = kanjiData.on_readings.join(', ');

                    outputDiv.innerHTML += `
                        <p class="kanji">${kanjiData.kanji}: 
                        <strong>Meanings:</strong> ${meanings} <br/>
                        <strong>Kunyomi:</strong> ${kunReadings || 'N/A'} <br/>
                        <strong>Onyomi:</strong> ${onReadings || 'N/A'} <br/>
                        <strong>Stroke count:</strong> ${kanjiData.stroke_count} <br/>
                        <strong>Grade:</strong> ${kanjiData.grade || 'N/A'} <br/>
                        <strong>JLPT Level:</strong> ${kanjiData.jlpt || 'N/A'} 
                        </p>
                    `;
                } else {
                    outputDiv.innerHTML += `<p class="kanji">${kanji}: Data not found</p>`;
                }
            }
        }
    </script>

</body>
</html>
