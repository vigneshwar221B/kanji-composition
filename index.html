<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanji Composition</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div class="container">
        <h1>Kanji Composition</h1>
        <input type="text" id="jpInput" placeholder="Enter Japanese text" />
        <button type="button" onclick="processInput()">Submit</button>
        <div id="output"></div>
    </div>

    <script>
        // Add event listener to detect "Enter" key press
        document.querySelector('#jpInput').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                processInput();
            }
        });

        async function processInput() {
            const jpText = document.querySelector('#jpInput').value;
            const outputDiv = document.querySelector('#output');
            outputDiv.innerHTML = 'Loading...'; // Show loading message

            if (!jpText.trim()) {
                outputDiv.innerHTML = 'Please enter some text.';
                return;
            }

            const kanjiArray = extractKanji(jpText);

            if (kanjiArray.length === 0) {
                outputDiv.innerHTML = 'No kanji found.';
                return;
            }

            await displayKanji(kanjiArray);
        }

        function extractKanji(text) {
            // Extract only kanji characters
            return text.split('').filter(char => char.match(/[\u4E00-\u9FAF]/));
        }

        async function getKanjiData(kanji) {
            try {
                const response = await fetch(`https://kanjiapi.dev/v1/kanji/${kanji}`);
                return response.json();
            } catch (error) {
                return null;
            }
        }

        async function displayKanji(kanjiArray) {
            const outputDiv = document.querySelector('#output');

            // Clear the loading message after data is fetched
            outputDiv.innerHTML = '';

            for (const kanji of kanjiArray) {
                const kanjiData = await getKanjiData(kanji);

                if (kanjiData) {
                    // Limit the meanings to a maximum of 3
                    const meanings = kanjiData.meanings.slice(0, 3).join(', ');

                    outputDiv.innerHTML += `<p class="kanji">${kanjiData.kanji}: ${meanings}</p>`;
                } else {
                    outputDiv.innerHTML += `<p class="kanji">${kanji}: Data not found</p>`;
                }
            }
        }
    </script>

</body>
</html>
